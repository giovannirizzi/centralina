Tutti i dispositivi anche la centralina hanno:
    un id
    uno stato
    dei registri
    degli interruttori.
    
I dispositivi di controllo hanno in più anche una lista pipe per parlare con i figli.
    




COMANDI DA IMPLEMENTARE:

[Richiesta]                                 [Risposta]
del                                         <id> <id> <id> : lista dei dispositivi eliminati, se il dispositivo è di iterazione
                                                            restituirà solo il suo, altrimenti tutto l'albero.
                                                            
info                                        <info> da definire bene il formato, però deve restituire: PID, id, tipo, stato, registri,
                                            dispositivi direttamente connessi se presenti? (oppure tutto l'albero però boh)
                                            
setconf <config>                            OK / ERROR: setta la configurazione del dispositivo

formato <config>: id:%d;type:%d;state:%d;reg:time=%d&bobobo=%d

getconf                                     <config> | <config> | | <config>.. : restituisce la configurazione del dispositivo compresi i figli,
                                            il simbolo | serve come carattere per serializzare l'albero -> andate a vedere come si serializza un albero.
                                            
                                            
add <config> | <config>...                  OK / ERROR: aggiungere l'albero ad un dispositivo di controllo.





SHELL sistema:

    la shell ha una lista di FILE* che corrispondono alle FIFO di tutti i device collegati al sistema.
    La shell parla hai dispositivi solo tramite FIFO e riceve la risposta nella sua FIFO
    
    add <device>
    Aggiunge un device e gli assegna una id unico 
    
    del <id>
    Manda il comando di del nella FIFO e rimuove il dispositivo dalla lista
    
    link <id1> to <id2>
    Manda il comando getconfig ad <id1>, del ad <id1>, add <config> ad <id2>
    
    info <id>
    Manda il comamndo info al dispositivo id tramite FIFO e aspetta la risposta.
    
    list
    Manda il comando info a tutti i dispositivi nella lista
    
    switch <id> <label> <pos>
    Inoltra il comando alla centralina
    
    set <id> <registro> <value>                                    
    

Device (Comandi di base che tutti i dispositivi devono implementare):

    setconf <config> <config> .... (sequenze di config per rappresentare una albero) - FIFO ED STDIN
    getconf <config> <config> .... - FIFO ED STDIN
    info    restituisce anche il proprio PID - FIFO ED STDIN
    del     (Deve restituire la lista dei dispositivi eliminati) - FIFO ED STDIN
    
    Ogni device deve aprire in lettura la propria FIFO che sarà tipo /system/<id>, quindi l'id univoco
    del device bisogna passarlo come arg nel main.
    
    Ogni device accetta come parametri del main un id, il signalfd, e un flag che indica se aspettare il settagggio tramite comando
    oppure avviarsi con il settaggio di default.
    
Device di controllo:

    add <config> <config> FIFO ED STDIN
    
    
    Comando per interruttori a 2 posizioni:
        
        switch <id> <interrutore> <pos> STDIN
        
    Comando per settare i valori nei registri ad esempio per il termostato
    
        set <id> <registro> <value> STDIN
    
  
Device di iterazione:

    Comando per interruttori a 2 posizioni:
        
        switch <interrutore> <pos> STDIN
        
    Comando per settare i valori nei registri ad esempio per il termostato
    
        set <registro> <value> STDIN
        
        
Centralina:
    Segnali:
        per interruttore generale forse?
    Comandi:
        non deve eseguire comandi
    Registro:
        num: numero di dispositivi direttamente connessi
    Args per inizializzazione
        nessuno
    Stato:
        on/off
    interruttore:
        generale on/off, cosa fa? invia power off/on a tutti i collegati?, viene modificato al comando switch 
        

Bulb:
    Segnali: 
        1 segnale per on/off stato
    Comandi:
        interruttori: 
            set on/off interruttore -> da risposta??
        get info -> da in risposta info
        delete?
    Registro
        time: tempo di utilizzo. come lo calcolo??
    Args per inizializzazione:  
        id ?? per named pipe eventualmente
        stato
        registro
        
Hub:
    Segnali: 
        no iterazioni al di fuori della centralina...? fa il mirroring degli interruttori...
    Comandi:
        interruttori: 
            boh fa il mirroring, tutti i comandi che riceve li invia ha i figli?
        get info -> da in risposta info anche in base hai figli
        delete? penso di si perché deve eliminare ricorsivamente i figli
        link per collegare altri dispositivi
    Registro:
        mirroring dei figli, cosa vuol dire??
    Stato:
        mirroring dei filgi, lo calcola on/off con ovverride eventualmente
    Args per inizializzazione:
        id per le pipe?
        e basta perché è tutto un mirroring
    
Windows:
    
    Segnali: 
        1  per aprire
        1 per chiudere
    Comandi:
        interruttori: 
            set open on/off
            set close on/off
        get info -> da in risposta info
        delete?
    Registro
        time: tempo di utilizzo. come lo calcolo??
    Args per inizializzazione:
        id ?? per named pipe eventualmente
        stato
        registro
        
Frigo:
    Segnali: 
        1 segnale per on/off stato
        1 segnale per aggiungere e togliere contenuto!?
        1 impostare termostato
    Comandi:
        interruttori: 
            set on/off interruttore
            set temp valore
        get info -> da in risposta info
        delete?
    Registro
        time: tempo di apertura. come lo calcolo?
        ​delay​ = tempo dopo cui si richiude automaticamente (la posso modificare)
​        perc​ = percentuale di riempimento (la modifico solo con intervento manuale)
​        temp​ = temperatura interna

    Args per inizializzazione:
        id ?? per named pipe eventualmente
        stato
        registro
        
Timer:
    boh, no si capisce...
        
        
